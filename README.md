# 智能骑行天气助手

基于天气条件为你的通勤骑行提供智能建议的Python应用程序。

## ✨ 功能特点

- 🌤️ **实时天气数据**: 使用和风天气API获取准确的天气信息
- 🏙️ **城市智能识别**: 自动将城市名称转换为精确的地理位置
- 🚴‍♂️ **智能骑行建议**: 基于温度、风速、降水等多维度分析
- ⚙️ **个性化设置**: 支持自定义温度、风速、降水偏好
- 🏠➡️🏢 **精准通勤分析**: 支持同区、同城跨区、跨城三种通勤类型识别
- 📍 **区级别精度**: 支持精确到区的地址解析和通勤建议
- 🌍 **双地址天气**: 当家庭和工作地址不在同一区时，自动获取两地天气数据
- 💡 **综合建议**: 基于两地天气情况提供更精准的通勤建议

## 🚀 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 获取和风天气API密钥
1. 访问 [和风天气开发平台](https://dev.qweather.com/)
2. 注册账号并登录
3. 创建应用获取API密钥（免费版每天1000次调用）

### 3. 配置文件
复制 `config.json.example` 为 `config.json` 并填入你的信息：

```json
{
  "home_city": "北京市朝阳区",
  "work_city": "北京市海淀区",
  "api_key": "你的和风天气API密钥",
  "preferences": {
    "min_temp": 5,        // 最低温度（摄氏度）
    "max_temp": 30,       // 最高温度（摄氏度）
    "max_wind_speed": 10, // 最大风速（m/s）
    "allow_rain": false   // 是否允许雨天骑行
  }
}
```

### 4. 运行程序
```bash
python main.py
```

## 📖 使用示例

```bash
$ python main.py
🏠 家庭地址: 鞍山市铁东区
🏢 工作地址: 鞍山市立山区
🚴 通勤类型: 同城跨区通勤

📡 正在获取 鞍山市铁东区 的天气信息...
📡 正在获取 鞍山市立山区 的天气信息...
✅ 工作地址天气数据获取成功
✅ 家庭地址天气数据获取成功

🌤️ 家庭地址天气概况:
温度: 28.0°C | 风速: 3.6m/s | 天气: 雾 | 湿度: 70%

🌤️ 工作地址天气概况:
温度: 28.0°C | 风速: 3.6m/s | 天气: 雾 | 湿度: 70%

✅ 从天气角度看，今天适合骑行!

💡 通勤建议:
📍 家庭地址 (鞍山市铁东区):
温度: 28.0°C | 风速: 3.6m/s | 天气: 雾 | 湿度: 70%

📍 工作地址 (鞍山市立山区):
温度: 28.0°C | 风速: 3.6m/s | 天气: 雾 | 湿度: 70%

🏠➡️🏢 同城跨区通勤建议:
✅ 两地天气都适合骑行
💡 建议: 同城跨区通勤，两地天气条件都良好，推荐骑行！
   • 预计骑行时间: 20-40分钟
   • 适合人群: 有一定体力基础，时间相对充裕
   • 准备事项: 带好水壶，规划好路线，避开拥堵路段
   • 路线建议: 选择自行车道或车流量较少的道路
   • 备选方案: 公交+共享单车组合
```

## 🔧 技术架构

### 核心模块
- **main.py**: 主程序入口，协调各模块工作
- **weather.py**: 天气数据获取和处理
- **core.py**: 核心逻辑，包括骑行适宜性判断和建议生成

### API调用流程
1. **城市ID查询**: 通过和风天气GeoAPI将城市名称转换为城市ID
2. **天气数据获取**: 使用城市ID调用实时天气API
3. **数据标准化**: 将和风天气数据转换为统一格式
4. **智能分析**: 基于天气数据和用户偏好生成建议

### 支持的天气条件
- ✅ 温度范围检查
- ✅ 风速限制
- ✅ 降水检测（雨、雪、雾等）
- ✅ 湿度和能见度分析

## 📝 配置说明

### 地址格式
- **推荐格式**: `城市名+区名`，如 `北京市朝阳区`、`上海市浦东新区`
- **城市级别**: `北京市`、`上海市`（适用于只关心城市级别的场景）
- **重名处理**: 对于重名城市，建议加上省份，如 `西安市,陕西`

### 通勤类型自动识别
- **同区通勤**: 家庭和工作在同一个区，距离最短（10-20分钟）
- **同城跨区通勤**: 同一城市不同区，中等距离（20-40分钟）
- **跨城通勤**: 不同城市，距离最远（1-2小时），一般不建议骑行

### 天气获取逻辑
- **同区通勤**: 只获取一次天气数据（家庭地址）
- **同城跨区通勤**: 获取两地天气数据，综合分析给出建议
- **跨城通勤**: 获取两地天气数据，重点考虑距离因素

### 建议类型
根据通勤类型和天气情况，系统会提供：
- **两地天气都适合**: 推荐骑行，提供详细准备建议
- **一地适合一地不适合**: 谨慎建议，提供风险评估和备选方案
- **两地都不适合**: 不建议骑行，推荐公共交通

### 偏好设置
- `min_temp`: 最低可接受温度（°C）
- `max_temp`: 最高可接受温度（°C）
- `max_wind_speed`: 最大可接受风速（m/s）
- `allow_rain`: 是否允许雨雪天气骑行

## 🔍 故障排除

### 常见问题
1. **城市查询失败**: 检查城市名称拼写，使用标准名称
2. **API错误**: 确认API密钥有效，检查调用次数限制
3. **网络超时**: 检查网络连接，稍后重试

### 调试技巧
- 查看详细的错误输出信息
- 验证API密钥在和风天气控制台中的状态
- 尝试不同格式的城市名称

## 📚 更新历史

- **v2.0**: 完全移除坐标依赖，直接使用城市名称
- **v1.1**: 移除地理编码功能，使用经纬度配置
- **v1.0**: 初始版本，支持地址自动编码

详细迁移指南请参考 [MIGRATION_GUIDE.md](MIGRATION_GUIDE.md)

## 📄 许可证

本项目仅供学习和个人使用。使用和风天气API请遵守其服务条款。