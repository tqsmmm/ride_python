# 地理编码功能移除迁移指南

## 📋 修改概述

本次更新移除了根据地址自动获取经纬度的地理编码功能，改为直接在配置文件中指定经纬度坐标。

## 🔄 主要变更

### 1. 配置文件格式变更

**旧格式:**
```json
{
  "home_address": "辽宁省鞍山市铁东区",
  "work_address": "辽宁省鞍山市立山区",
  "api_key": "your_api_key",
  "preferences": { ... }
}
```

**新格式:**
```json
{
  "home_location": {
    "name": "辽宁省鞍山市铁东区",
    "lat": 41.1086,
    "lon": 122.9944
  },
  "work_location": {
    "name": "辽宁省鞍山市立山区", 
    "lat": 41.1497,
    "lon": 122.9658
  },
  "api_key": "your_api_key",
  "preferences": { ... }
}
```

### 2. 移除的功能

- ❌ `get_coordinates()` 函数 - 地址转经纬度
- ❌ OpenStreetMap Nominatim API 调用
- ❌ 网络地理编码请求

### 3. 保留的功能

- ✅ `get_city_from_address()` 函数 - 从地址提取城市名
- ✅ 同城/跨城通勤判断
- ✅ 天气获取和骑行建议

## 🛠️ 迁移步骤

### 步骤1: 获取经纬度坐标

你需要手动获取地址的经纬度坐标。可以通过以下方式：

1. **使用在线地图工具:**
   - 百度地图拾取坐标系统
   - 高德地图坐标拾取器
   - Google Maps

2. **使用地理编码API:**
   - 百度地图API
   - 高德地图API
   - 腾讯地图API

### 步骤2: 更新配置文件

将你的 `config.json` 文件按照新格式更新：

```json
{
  "home_location": {
    "name": "你的家庭地址",
    "lat": 纬度数值,
    "lon": 经度数值
  },
  "work_location": {
    "name": "你的工作地址",
    "lat": 纬度数值,
    "lon": 经度数值
  },
  "api_key": "你的和风天气API密钥",
  "preferences": {
    "min_temp": 5,
    "max_temp": 30,
    "max_wind_speed": 10,
    "allow_rain": false
  }
}
```

## 💡 修改原因

1. **消除网络依赖:** 移除对外部地理编码服务的依赖
2. **提高稳定性:** 避免网络连接问题导致的程序失败
3. **提升性能:** 直接使用坐标，无需额外的API调用
4. **简化部署:** 减少外部服务依赖，降低配置复杂度

## 🔍 注意事项

- 确保经纬度坐标的准确性
- 坐标格式使用十进制度数（如：39.9042）
- 纬度范围：-90 到 90
- 经度范围：-180 到 180
- 中国大陆地区纬度大约在 18°-54°，经度大约在 73°-135°

## 📞 获取帮助

如果在迁移过程中遇到问题，可以：
1. 检查配置文件JSON格式是否正确
2. 验证经纬度坐标是否在合理范围内
3. 确认API密钥是否有效